<html>
  <head>
    <title></title>
    <meta charset="UTF-8">
    <meta charset="ISO-8859-1">
    <style></style>
  </head>
  <body>
    <form>
      Select a file for the canvas font: <input type="file" name="myFile" id="imagen"><br><br>
      <input type="text" id = "height" value = "800">
      <input type="text" id = "width" value = "600">
      <input type="button" id = "submit" value="Doble click para pintar">
    </form>
    <canvas id = 'canvas'></canvas>

  <!-- <script src="js/mapa_dinamico.js"></script> -->
  <script>
    function $(id){
      return document.getElementById(id);
    }
  (function() {
    'use strict';

    var button = $("submit");
    var canvas = $('canvas');
    var lastPress = null;
    var mousex = 0, mousey = 0;
    var scaleX = null;
    var scaleY = null;
    var lienzo_2d = canvas.getContext('2d');
    var rect = canvas.getBoundingClientRect();
    var img_canvas = new Image();

    //actualizando y el puntero
    canvas.addEventListener('mousemove', function (evt) {
      var rect = canvas.getBoundingClientRect();
      mousex = (evt.clientX - rect.left)*scaleX;
      mousey = (evt.clientY - rect.top)*scaleY;
    }, false);

    //actualizando la imagen
    canvas.addEventListener('click', function (evt) {
      console.log(mousex+":"+mousey);
      lastPress = evt.which;
    }, false);

    button.addEventListener('click', function (){

      var img = $("imagen");
      var img_new = img.value.replace("C:\\fakepath\\", "");

      scaleX = canvas.width / rect.width;
      scaleY = canvas.height / rect.height;
      img_canvas.src= "img_maps/"+img_new;

      window.setTimeout(paint(img_canvas), 25);

    });

    function paint(img_canvas){
      var size = {
        width: $('width').value,
        height: $('height').value
      }
      lienzo_2d.canvas.width = size.width;
      lienzo_2d.canvas.height = size.height;
      lienzo_2d.drawImage(img_canvas, 0, 0, canvas.width-5, canvas.height-5);
    }

    window.addEventListener("resize", function(){
        rect = canvas.getBoundingClientRect();
        scaleX = canvas.width / rect.width;
        scaleY = canvas.height / rect.height;
    }, false);

  })();
  </script>
  </body>
</html>